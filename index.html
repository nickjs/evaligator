<html>
<head>
  <title>Evaligator</title>
  <link rel="stylesheet" type="text/css" href="style.css" title="default">
  <link href='http://fonts.googleapis.com/css?family=Droid+Sans:400,700' rel='stylesheet' type='text/css'>
</head>
<body>
  <div id="transmogrifier-debug-output" style="position:absolute;left:0;top:0;background-color:#fff;font-family:Menlo"></div>

  <div class="pageTitle">evaligator.js<br/>
    <span class="alligator">^^^^^U^^^U^=___ </span>
  </div>

  <div class="notEditor">
    <h1>What it is</h1>
    <p>CoffeeScript thingamajig. As you type javascript code on the left, it gets automagically evaluated on the right.</p>
    <p>Start typing things below. Or,
    <input type="button" class="button" value="load" onClick="loadExample();"> an example.
    And then type things.</p>
  </div>

  <div id="editor"></div>

  <div class="notEditor">
    <h1>Stuff that works</h1>
    <p>Variables, assignments, loops, if statements, changing the value of a variable somewhere and seeing the change propagate everywhere, js syntax errors (thanks ace!)</p>

    <h1>Stuff that doesn't</h1>
    <p>things that make it go into infinite loops, asking it to do the dishes, functions</p>
  </div>

  <!-- <div id="visualismifier"></div> -->
  <script src="ace/ace.js" type="text/javascript"></script>
  <script src="ace/theme-monokai-uncompressed.js" type="text/javascript"></script>
  <script src="lib/parser.js" type="text/javascript"></script>
  <script src="lib/coffee-script.js" type="text/javascript"></script>
  <script src="evaligator.coffee" type="text/coffeescript"></script>

  <script type="text/coffeescript">
    window.DEBUG_THE_EVALIGATOR = window.location.hash.toLowerCase().indexOf('debug') isnt -1

    @loadExample = ->
      # initialize the editor with some random stuff
      sampleCode = """
      var a = 0;
      var b = a;

      var arr = ['tuna', 'fish'];
      var allTheOddThings = '';

      for (var i = 0; i < 2 * arr.length; i++){
           b += i;
           if (b % 2 != 0){
              allTheOddThings += b + ', ';
           }
      }"""

      window.Editor.split.getEditor(0).getSession().setValue sampleCode

    class EditorView
      EditSession = require('ace/edit_session').EditSession
      UndoManager = require('ace/undomanager').UndoManager
      Split = require('ace/split').Split
      Mode = require('ace/mode/javascript').Mode

      constructor: (node) ->
        @split = new Split node, require('ace/theme/monokai'), 2

        workerlessMode = new Mode
        workerlessMode.createWorker = ->

        @editor = @split.getEditor(0)
        @editor.getSession().setMode new Mode
        @editor.getSession().setUndoManager new UndoManager

        @viewer = @split.getEditor(1)
        @viewer.getSession().setMode workerlessMode
        @viewer.setHighlightActiveLine no
        @viewer.setShowPrintMargin no
        @viewer.setReadOnly yes

        @editor.focus()

        window.addEventListener 'resize', =>
          @split.resize()

        @editor.getSession().on 'change', =>
          theHopefullyNotArbitraryTextThatWasTyped = @editor.getSession().getDocument().getValue()

          codeParser = new SourceCodeParser
          codeParser.parseThemSourceCodes theHopefullyNotArbitraryTextThatWasTyped

          @split.getEditor(1).getSession().setValue codeParser.displayValue()



    window.Editor = new EditorView document.getElementById('editor')
</script>

</body>
</html>
